<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RideSafe - Book Your Ride</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCFOS8a0W3jNKcRpFIyJSEwblcj-KQr9pc&libraries=places"></script>
    <script async defer src="https://apis.google.com/js/api.js"
        onload="this.onload=function(){};gapi.load('auth2', function(){ gapi.auth2.init({client_id: 'YOUR_GOOGLE_CLIENT_ID'}); });"></script>
    <style>
        /* RideSafe CSS: Dark Red Scheme (Inspired by Deep Red Palettes - #8B0000 Base for Intensity, WCAG AA+ Legibility) */
        :root {
            --bg-primary: #2a0000; /* Deep maroon bg for immersive feel */
            --bg-fade: #500000; /* Faded dark red gradient accents */
            --text-light: #fdf9f7; /* Soft off-white text for high contrast */
            --red-brand: #8B0000; /* Dark red (maroon) - researched for psychological intensity and web usability */
            --red-glow: rgba(139, 0, 0, 0.3); /* Subtle glow for hover/focus, enhances "boner worthy" visual pop */
            --border-thin: 1px solid var(--red-brand);
            --container-bg: #400000; /* Slightly lighter dark red for containers */
            --input-bg: #500000; /* Dark input bg for cohesion */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            background-image: radial-gradient(circle at top left, var(--bg-fade) 0%, transparent 70%), radial-gradient(circle at bottom right, var(--bg-fade) 0%, transparent 70%);
            color: var(--text-light);
            line-height: 1.7;
            padding: 1rem;
            min-height: 100vh;
            opacity: 1;
            transition: opacity 0.5s ease-in-out; /* Smoother fade for sexy entrance */
        }

        .app { max-width: 600px; margin: 0 auto; }

        .title-section {
            text-align: center;
            margin-bottom: 2rem;
            animation: glowFadeIn 1s ease-out; /* Enhanced animation for title */
        }

        .title {
            font-size: 3.5rem; /* Bigger for impact */
            font-weight: bold;
            color: var(--red-brand);
            text-align: center;
            margin-bottom: 0.5rem;
            letter-spacing: 3px; /* More spacing for elegance */
            text-shadow: 0 0 10px var(--red-glow); /* Glow effect for "boner worthy" vibe */
        }

        .motto {
            font-size: 1.2rem;
            color: var(--text-light);
            font-style: italic;
            opacity: 0.9;
            text-shadow: 0 0 5px var(--red-glow);
        }

        .logo {
            width: 80px; /* Larger logo for prominence */
            height: auto;
            vertical-align: middle;
            margin-right: 1rem;
            filter: drop-shadow(0 0 10px var(--red-glow)); /* Sexy shadow */
            transition: transform 0.3s ease;
        }

        .logo:hover { transform: rotate(5deg) scale(1.1); } /* Interactive hover */

        header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 1rem 0;
        }

        @keyframes glowFadeIn { from { opacity: 0; transform: translateY(-20px); text-shadow: none; } to { opacity: 1; transform: translateY(0); text-shadow: 0 0 10px var(--red-glow); } }

        .tesla-icon { font-size: 2.5rem; cursor: pointer; transition: transform 0.3s ease, color 0.3s; color: var(--red-brand); }
        .tesla-icon:hover { transform: scale(1.2) rotate(10deg); color: #FF0000; } /* Dynamic hover */
        .driver-btn { background: var(--red-brand); border: none; color: var(--text-light); font-size: 1rem; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; opacity: 0; transition: opacity 0.5s ease, transform 0.3s; }
        .driver-btn.show { opacity: 1; }
        .driver-btn:hover { transform: scale(1.05); }

        .container {
            background: var(--container-bg);
            border-radius: 20px;
            padding: 2rem;
            border: var(--border-thin);
            box-shadow: 0 4px 30px rgba(139, 0, 0, 0.4); /* Deeper shadow for depth */
            animation: slideUpGlow 0.8s ease-out 0.2s both;
        }

        form { display: flex; flex-direction: column; gap: 1.5rem; }
        @keyframes slideUpGlow { from { opacity: 0; transform: translateY(30px); box-shadow: none; } to { opacity: 1; transform: translateY(0); box-shadow: 0 4px 30px rgba(139, 0, 0, 0.4); } }

        label { font-weight: bold; font-size: 16px; display: block; margin-bottom: 0.5rem; color: var(--text-light); }
        input, select { font-size: 14px; padding: 0.75rem; border: var(--border-thin); border-radius: 8px; transition: box-shadow 0.3s ease, border-color 0.3s; background: var(--input-bg); color: var(--text-light); width: 100%; }
        input:focus, select:focus { outline: none; box-shadow: 0 0 0 4px var(--red-glow); border-color: #FF0000; } /* Brighter focus */

        .autocomplete { position: relative; }
        .suggestions { position: absolute; top: 100%; left: 0; right: 0; background: var(--container-bg); border: var(--border-thin); border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 10; opacity: 0; transition: opacity 0.3s ease; color: var(--text-light); }
        .suggestions.show { opacity: 1; }
        .suggestion { padding: 0.75rem; cursor: pointer; border-bottom: var(--border-thin); transition: background 0.3s ease; }
        .suggestion:hover { background: var(--red-glow); }
        .suggestion:last-child { border-bottom: none; }

        .price-display { text-align: center; font-size: 20px; font-weight: bold; margin: 1rem 0; padding: 1rem; border: var(--border-thin); border-radius: 8px; background: var(--input-bg); animation: pulseGlow 1s ease-out; color: var(--text-light); }
        @keyframes pulseGlow { 0% { transform: scale(1.1); box-shadow: 0 0 20px var(--red-glow); } 100% { transform: scale(1); box-shadow: none; } }

        .book-btn { background: var(--red-brand); color: var(--text-light); font-weight: bold; font-size: 18px; padding: 1.2rem; border: none; border-radius: 8px; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s; box-shadow: 0 0 10px var(--red-glow); }
        .book-btn:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 0 20px var(--red-glow); }
        .book-btn:disabled { opacity: 0.5; cursor: not-allowed; box-shadow: none; }

        .loading { opacity: 0.7; pointer-events: none; }
        .hidden { display: none; }

        /* Mobile-First Enhancements */
        @media (max-width: 480px) { body { padding: 0.5rem; } header { flex-direction: column; gap: 1rem; } .suggestions { position: fixed; left: 1rem; right: 1rem; } .title { font-size: 2.5rem; } .container { padding: 1rem; } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Firebase Config (Provided)
        const firebaseConfig = {
            apiKey: "AIzaSyDC22Z2fuGTc7j9Gm7JKO5dB2NJTiHGIB0",
            authDomain: "ridesafe-app-2faa9.firebaseapp.com",
            databaseURL: "https://ridesafe-app-2faa9-default-rtdb.firebaseio.com/",
            projectId: "ridesafe-app-2faa9",
            storageBucket: "ridesafe-app-2faa9.appspot.com",
            messagingSenderId: "516451873273",
            appId: "1:516451873273:web:0bd8e6027b72c1e0580d28"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // EmailJS Init (Swap Template/Public Keys if needed)
        emailjs.init('YOUR_PUBLIC_KEY');

        // Country Club Coords (Fixed Base)
        const countryClub = { lat: 30.4103, lng: -91.1868 };

        // Get Distance (Real Google API)
        const getDistance = async (origin, dest) => {
            const apiKey = 'AIzaSyCFOS8a0W3jNKcRpFIyJSEwblcj-KQr9pc';
            try {
                const response = await fetch(`https://maps.googleapis.com/maps/api/distancematrix/json?origins=${encodeURIComponent(origin)}&destinations=${encodeURIComponent(dest)}&key=${apiKey}`);
                const data = await response.json();
                if (data.status !== 'OK' || data.rows[0].elements[0].status !== 'OK') throw new Error(data.status || data.rows[0].elements[0].status);
                return data.rows[0].elements[0];
            } catch (err) {
                console.error('Distance API error:', err);
                return { distance: { value: 10 * 1609.34 }, duration: { value: 15 * 60 } }; // Fallback
            }
        };

        // Get Dist from Country Club (Real API)
        const getDistFromBase = async (origin) => {
            const apiKey = 'AIzaSyCFOS8a0W3jNKcRpFIyJSEwblcj-KQr9pc';
            try {
                const geocoder = new google.maps.Geocoder();
                const originCoords = await new Promise((resolve, reject) => {
                    geocoder.geocode({ address: origin }, (results, status) => {
                        if (status === 'OK') resolve(results[0].geometry.location);
                        else reject(status);
                    });
                });
                const response = await fetch(`https://maps.googleapis.com/maps/api/distancematrix/json?origins=${originCoords.lat()},${originCoords.lng()}&destinations=${countryClub.lat},${countryClub.lng}&key=${apiKey}`);
                const data = await response.json();
                if (data.status !== 'OK') throw new Error(data.status);
                return data.rows[0].elements[0].distance.value / 1609.34; // miles
            } catch (err) {
                console.error('Base Dist error:', err);
                return 10; // Fallback
            }
        };

        // Surge Mult
        const getSurge = (dateStr, timeStr) => {
            const dt = new Date(`${dateStr}T${timeStr}:00`);
            const hour = dt.getHours() + (dt.getMinutes() / 60);
            const day = dt.getDay();
            if (hour >= 16.5 && hour <= 18.5 && day >= 1 && day <= 5) return 1.4;
            if (day === 5 && hour >= 17) return 1.6;
            if ((day === 0 || day === 6) && hour >= 20) return 1.8;
            return 1;
        };

        // Price Calc
        const calcPrice = async (origin, dest, date, time) => {
            if (!origin || !dest || !date || !time) return 0;
            const { distance, duration } = await getDistance(origin, dest);
            const miles = distance.value / 1609.34;
            const mins = duration.value / 60;
            const base = 1.05 + (1.05 * miles) + (0.15 * mins);
            const baseDist = await getDistFromBase(origin);
            const distMult = baseDist <= 10 ? 1 : baseDist <= 20 ? 1.25 : baseDist <= 35 ? 1.42 : 2;
            const surge = getSurge(date, time);
            return Math.round((base * distMult * surge) * 100) / 100;
        };

        // Main App
        const RideSafeApp = () => {
            const [formData, setFormData] = useState({
                name: localStorage.getItem('rs_name') || '',
                email: localStorage.getItem('rs_email') || '',
                phone: localStorage.getItem('rs_phone') || '',
                origin: localStorage.getItem('rs_origin') || '',
                dest: localStorage.getItem('rs_dest') || '',
                date: localStorage.getItem('rs_date') || '',
                time: localStorage.getItem('rs_time') || '',
                price: 0
            });
            const [loading, setLoading] = useState(false);
            const [showDriver, setShowDriver] = useState(false);
            const originRef = useRef(null);
            const destRef = useRef(null);

            useEffect(() => {
                Object.entries(formData).forEach(([k, v]) => localStorage.setItem(`rs_${k}`, v));
                if (formData.origin && formData.dest && formData.date && formData.time) {
                    setLoading(true);
                    calcPrice(formData.origin, formData.dest, formData.date, formData.time).then(price => {
                        setFormData(p => ({ ...p, price }));
                        setLoading(false);
                    }).catch(() => setLoading(false));
                }
            }, [formData.origin, formData.dest, formData.date, formData.time]);

            useEffect(() => {
                if (originRef.current) {
                    const autocomplete = new google.maps.places.Autocomplete(originRef.current, { types: ['geocode'] });
                    autocomplete.addListener('place_changed', () => {
                        const place = autocomplete.getPlace();
                        setFormData(p => ({ ...p, origin: place.formatted_address || originRef.current.value }));
                    });
                }
                if (destRef.current) {
                    const autocomplete = new google.maps.places.Autocomplete(destRef.current, { types: ['geocode'] });
                    autocomplete.addListener('place_changed', () => {
                        const place = autocomplete.getPlace();
                        setFormData(p => ({ ...p, dest: place.formatted_address || destRef.current.value }));
                    });
                }
            }, []);

            const handleInput = (e) => {
                const { name, value } = e.target;
                setFormData(p => ({ ...p, [name]: value }));
            };

            const bookRide = async (e) => {
                e.preventDefault();
                if (!formData.price) return alert('Fill all fields for quote.');
                setLoading(true);
                try {
                    await emailjs.send('service_2ss0i0l', 'YOUR_TEMPLATE_ID', {
                        name: formData.name, email: formData.email, phone: formData.phone,
                        origin: formData.origin, dest: formData.dest, date: formData.date,
                        time: formData.time, price: formData.price
                    }, 'YOUR_PUBLIC_KEY');

                    const authInstance = gapi.auth2.getAuthInstance();
                    if (!authInstance.isSignedIn.get()) await authInstance.signIn();
                    const token = authInstance.currentUser.get().getAuthResponse().access_token;
                    const endTime = new Date(new Date(`${formData.date}T${formData.time}:00`).getTime() + 60*60*1000).toISOString();
                    await fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events', {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            summary: `RideSafe Booking: ${formData.origin} → ${formData.dest}`,
                            description: `Passenger: ${formData.name} (${formData.phone})\nEst: $${formData.price}\nPay end-of-ride.`,
                            start: { dateTime: `${formData.date}T${formData.time}:00`, timeZone: 'America/Chicago' },
                            end: { dateTime: endTime, timeZone: 'America/Chicago' }
                        })
                    });

                    await db.ref('bookings').push({ ...formData, timestamp: Date.now() });

                    alert(`Booked! Email sent, calendar updated. Price: $${formData.price} (pay end).`);
                    setFormData({ ...formData, price: 0 });
                } catch (err) {
                    console.error('Booking failed:', err);
                    alert('Booking issue (likely keys)—check console. Firebase archived anyway.');
                }
                setLoading(false);
            };

            return (
                <div className="app">
                    <div className="title-section">
                        <img src="https://lancewoolie.com/RideSafe/img/model3.png" alt="Tesla Model 3" className="logo" />
                        <div className="title">RideSafe</div>
                        <div className="motto">Safety should not be a luxury</div>
                    </div>
                    <header>
                        <div className="tesla-icon" onClick={() => location.reload()}>⚡</div>
                        <button className={`driver-btn ${showDriver ? 'show' : ''}`} onClick={() => { setShowDriver(!showDriver); console.log('Driver signup clicked'); }}>Become a Driver</button>
                    </header>
                    <div className="container">
                        <form onSubmit={bookRide}>
                            <label htmlFor="name">Name</label>
                            <input id="name" name="name" value={formData.name} onChange={handleInput} placeholder="e.g., Rachel" required />

                            <label htmlFor="email">Email</label>
                            <input id="email" name="email" type="email" value={formData.email} onChange={handleInput} placeholder="rachel@example.com" required />

                            <label htmlFor="phone">Phone</label>
                            <input id="phone" name="phone" type="tel" value={formData.phone} onChange={handleInput} placeholder="(225) 123-4567" required />

                            <label htmlFor="origin">Origin Address</label>
                            <div className="autocomplete">
                                <input ref={originRef} id="origin" name="origin" value={formData.origin} onChange={handleInput} placeholder="e.g., Baton Rouge" required />
                            </div>

                            <label htmlFor="dest">Destination Address</label>
                            <div className="autocomplete">
                                <input ref={destRef} id="dest" name="dest" value={formData.dest} onChange={handleInput} placeholder="e.g., New Orleans" required />
                            </div>

                            <label htmlFor="date">Date</label>
                            <input id="date" name="date" type="date" value={formData.date} onChange={handleInput} required />

                            <label htmlFor="time">Time</label>
                            <input id="time" name="time" type="time" value={formData.time} onChange={handleInput} required />

                            <div className="price-display">Est. Price: ${loading ? '...' : formData.price || 'Enter details'}</div>

                            <button type="submit" className="book-btn" disabled={loading || !formData.price}>Book It (Pay End-of-Ride)</button>
                        </form>
                    </div>
                </div>
            );
        };

        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RideSafeApp />);
    </script>
</body>
</html>

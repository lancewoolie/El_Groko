<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tipping & Requests - Lance Woolie</title>
    <link href="https://fonts.googleapis.com/css2?family=Georgia&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Georgia', serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 10px; 
            background-color: #1e3a8a; /* Dark royal blue */
            color: #E0E0E0; /* Light grey text */
        }
        h1, h2 { 
            text-align: center; 
            color: #FFD700; /* Gold */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #0074D9; /* Blue */
            color: #E0E0E0; /* Light grey */
            border: 2px solid #0074D9; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: bold;
            transition: all 0.3s ease;
        }
        button:hover { 
            background: #FFD700; /* Gold on hover */
            color: #001f3f; /* Dark blue text */
            border-color: #FFD700;
            transform: scale(1.05);
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        #tip-section, #custom-section { 
            background: linear-gradient(rgba(0, 31, 63, 0.8), rgba(30, 58, 138, 0.8)); 
            padding: 15px; 
            margin: 10px 0; 
            border: 2px solid #0074D9; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0, 116, 217, 0.3);
        }
        #tip-section button { 
            background: #28a745; /* Green for quick tips */
            color: #001f3f; /* Dark blue text */
            border: 2px solid #28a745;
        }
        #tip-section button:hover { 
            background: #218838; /* Darker green */
            border-color: #218838; 
            color: #001f3f;
        }
        #tip-section .free-suggestion {
            background: #FFD700; /* Yellow for suggestion */
            color: #001f3f;
            border: 2px solid #FFD700;
        }
        #tip-section .free-suggestion:hover {
            background: #e6c200;
            border-color: #e6c200;
        }
        #tip-section .custom-tip-btn {
            background: #FF00FF; /* Magenta for custom tip */
            color: #001f3f;
            border: 2px solid #FF00FF;
        }
        #tip-section .custom-tip-btn:hover {
            background: #E600E6; /* Darker magenta */
            border-color: #E600E6;
            color: #001f3f;
        }
        .custom-tip-row { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            margin-top: 10px; 
        }
        .custom-tip-row input { 
            flex: 1; 
            min-width: 100px; 
            background: #001f3f; 
            color: #E0E0E0; 
            border: 1px solid #0074D9; 
        }
        input, textarea { 
            width: 100%; 
            padding: 10px; 
            margin: 5px 0; 
            border: 2px solid #0074D9; 
            border-radius: 5px; 
            box-sizing: border-box; 
            background: #001f3f; 
            color: #E0E0E0;
        }
        input::placeholder, textarea::placeholder {
            color: #808080; /* Grey placeholder */
        }
        #cart-icon { 
            position: fixed; 
            top: 10px; 
            right: 10px; 
            background: linear-gradient(45deg, #FFD700, #e6c200); 
            color: #001f3f; 
            padding: 10px; 
            border-radius: 50px; 
            font-weight: bold; 
            cursor: pointer; 
            border: 2px solid #FFD700;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        details { 
            margin: 10px 0; 
            border: 2px solid #0074D9; 
            border-radius: 15px; 
            overflow: hidden;
        }
        details summary { 
            padding: 10px; 
            background: #0074D9; /* Blue */
            color: #E0E0E0; 
            cursor: pointer; 
            border-radius: 5px; 
            font-weight: bold; 
        }
        details ul { 
            list-style: none; 
            padding: 0; 
            margin: 0; 
            background: #1e3a8a;
        }
        details li { 
            padding: 10px; 
            background: #001f3f; 
            margin: 5px 0; 
            cursor: pointer; 
            border-radius: 5px; 
            border: 1px solid #0074D9; 
            display: flex; 
            align-items: center; 
            color: #E0E0E0;
        }
        details li:hover { 
            background: #FFD700; 
            color: #001f3f; 
            border-color: #FFD700;
        }
        .song-icon { 
            margin-right: 8px; 
            font-size: 20px; 
        }
        #artists-section { 
            margin: 20px 0; 
        }
        #alpha-nav { 
            text-align: center; 
            margin: 20px 0; 
            font-size: 18px; 
        }
        #alpha-nav a {
            color: #FFD700;
            text-decoration: none;
            margin: 0 1px;
            padding: 4px 6px;
            border-radius: 50%;
            background: rgba(0, 116, 217, 0.2);
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 14px;
        }
        #alpha-nav a:hover {
            background: #FFD700;
            color: #001f3f;
            transform: scale(1.1);
        }
        #cart-section { 
            display: none; 
            background: linear-gradient(rgba(0, 31, 63, 0.8), rgba(30, 58, 138, 0.8)); 
            padding: 20px; 
            margin: 20px 0; 
            border: 2px solid #0074D9; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0, 116, 217, 0.3);
            color: #E0E0E0;
        }
        #cart-items li { 
            padding: 10px; 
            border-bottom: 1px solid #0074D9; 
            position: relative; 
            background: #001f3f; 
            border-radius: 5px;
            color: #E0E0E0;
        }
        .remove-btn { 
            color: #FF4500; /* Red-orange */
            cursor: pointer; 
            font-size: 18px; 
            position: absolute; 
            right: 10px; 
            top: 50%; 
            transform: translateY(-50%); 
        }
        .roundup-section { 
            margin: 10px 0; 
            color: #E0E0E0;
        }
        .roundup-section input[type="checkbox"] { 
            margin-right: 10px; 
        }
        #thankyou { 
            display: none; 
            text-align: center; 
            background: linear-gradient(rgba(0, 31, 63, 0.8), rgba(30, 58, 138, 0.8)); 
            padding: 20px; 
            border: 2px solid #0074D9; 
            border-radius: 15px; 
            color: #E0E0E0; 
            box-shadow: 0 4px 15px rgba(0, 116, 217, 0.3);
        }
        #thankyou p {
            font-size: 18px;
            font-style: italic;
            margin: 10px 0;
        }
        #thankyou .signature {
            font-size: 16px;
            color: #FFD700;
            margin-top: 20px;
        }
        #paypal-button-container { 
            margin: 20px 0; 
        }
        #notification { 
            position: fixed; 
            top: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: #28a745; 
            color: #001f3f; 
            padding: 15px 25px; 
            border-radius: 5px; 
            font-weight: bold; 
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3); 
            z-index: 1000; 
            display: none; 
            transition: opacity 0.3s ease; 
        }
        #notification.show { 
            display: block; 
            animation: flash 3s ease-in-out; 
        }
        @keyframes flash { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0.7; } 
        }
        .disabled-overlay {
            pointer-events: none;
            opacity: 0.5;
        }
    </style>
    <!-- PayPal SDK - Updated to Live Client ID -->
    <script src="https://www.paypal.com/sdk/js?client-id=ASRba7-FvkDy2tHeAfQsKwfW7QBa57vol1_OsQrozTbZo0zZVz2y4c3jIR0isEQ_X3e1IsLMcaHd_jP2&currency=USD"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Tipping & Requests</h1>
    <div id="cart-icon" onclick="showCart()"> (<span id="cart-count">0</span>)</div>
    
    <div id="notification"></div>
    
<div id="tip-section">
    <h2>Quick Tip or Suggestion</h2>
    <button onclick="addTip(2)">$2 Tip</button>
    <button onclick="addTip(5)">$5 Tip</button>
    <button onclick="addTip(15)">$15 Tip</button>
    <button onclick="addTip(20)">$20 Tip</button>
    <button class="free-suggestion" onclick="freeSuggestion()">Free Suggestion</button>
    <div class="custom-tip-row">
        <input id="custom-tip" type="number" min="0" step="1" placeholder="enter any tip amount">
        <button class="custom-tip-btn" onclick="addCustomTip()">Tip other amount</button>
    </div>
</div>

<button onclick="showCart()">View Song Cue (Cart)</button>

<h2>Song Requests by Artist</h2>
<div id="artists-section">
    <!-- Artists will load here -->
</div>

<div id="custom-section">
    <h2>Song not listed? custom song request!</h2>
    <input id="custom-song" placeholder='"Artist Name (Led Zeplin) -Song Name (Stairway To Heaven)"'>
    <button onclick="addCustomSong()">Add $20 Custom Song Request</button>
</div>

<div id="cart-section">
    <h2>Your Song Cue</h2>
    <ul id="cart-items"></ul>
    <p><strong>Total: $<span id="total">0</span></p>
    <div class="roundup-section">
        <label><input type="checkbox" id="roundup" onchange="toggleRoundup()"> Round up to next $10 (pay more!)</label>
    </div>
    <form id="checkout-form">
        <input name="Fan Name" placeholder="(audience member name, IE Tex Hooper)" required>
        <textarea name="message" placeholder="Custom Message to the Band (optional, e.g. 'Epstein didn't kill himself!')"></textarea>
        <div id="paypal-button-container" style="display: none;"></div>
        <button type="submit">Check Out & Cue Songs!</button>
    </form>
</div>

<div id="thankyou">
    <h2>Thank You!</h2>
    <p id="thankyou-message">Your request is queued. Rock on! </p>
    <p>Your request is queued. Rock on! </p>
    <div class="signature">Many tacos,<br>Lance</div>
    <button onclick="location.reload()">Start Over</button>
</div>

<script>
    // Firebase config from contacts.html
    const firebaseConfig = {
      apiKey: "AIzaSyAJQMdogiDwB0oLf2I_Jp-6NSLTDcXvVcQ",
      authDomain: "lance-woolie-webfarm.firebaseapp.com",
      projectId: "lance-woolie-webfarm",
      storageBucket: "lance-woolie-webfarm.firebasestorage.app",
      messagingSenderId: "278461194969",
      appId: "1:278461194969:web:a2a03c9d27ccbb670814c8",
      measurementId: "G-D734JL7BFR"
    };

    // Thank you messages array
    const thankYouMessages = [
        "You are my biggest fan in the room! Thank you so much!",
        "Holy Moley! You are doing the Lord's work! Thank you so much for your contribution.",
        "Rootin Tootin! you are my jam! Thank you!",
        "Yeehaw! Your support hits harder than a double bass drum. Grateful beyond words!",
        "Whoa there, partner— you just made this cowboy's night! Thanks a million.",
        "Dang, you're the real MVP of this hoedown. Heartfelt thanks!",
        "Hot diggity, that's the kind of generosity that fuels the fire! You're a legend."
    ];

    // Songs Data (prices hidden: A=50, B=25, C=15, D=10, E=5; icons per song)
    const songsData = {"Aaron Watson":{"songs":["July In Cheyenne"],"prices":{"July In Cheyenne":"E"},"icons":{"July In Cheyenne":""}},"Alabama":{"songs":["Dixieland Delight","My Homes In Alabama"],"prices":{"Dixieland Delight":"E","My Homes In Alabama":"E"},"icons":{"Dixieland Delight":"","My Homes In Alabama":""}},"Alan Jackson":{"songs":["Midnight in Montgomery","Dont Rock The Jukebox","Chatahooche"],"prices":{"Midnight in Montgomery":"E","Dont Rock The Jukebox":"E","Chatahooche":"C"},"icons":{"Midnight in Montgomery":"","Dont Rock The Jukebox":"","Chatahooche":""}},"Alice in Chains":{"songs":["Nutshell","Man in The Box"],"prices":{"Nutshell":"E","Man in The Box":"E"},"icons":{"Nutshell":"","Man in The Box":""}},"Andrea Bocelli":{"songs":["Canciones Desinfindada","Bésame"],"prices":{"Canciones Desinfindada":"E","Bésame":"E"},"icons":{"Canciones Desinfindada":"","Bésame":""}},"Anybody You Choose":{"songs":["Happy Birthday Song","Improv song about an audience member"],"prices":{"Happy Birthday Song":"B","Improv song about an audience member":"A"},"icons":{"Happy Birthday Song":"","Improv song about an audience member":""}},"Bad Religion":{"songs":["Whispers In Time","Man With a Mission","To Another Abyss"],"prices":{"Whispers In Time":"E","Man With a Mission":"E","To Another Abyss":"E"},"icons":{"Whispers In Time":"","Man With a Mission":"","To Another Abyss":""}},"Blackberry Smoke":{"songs":["1 Horse Town","Up The Road","I've Got This Song"],"prices":{"1 Horse Town":"C","Up The Road":"E","I've Got This Song":"E"},"icons":{"1 Horse Town":"","Up The Road":"","I've Got This Song":""}},"Brooks & Dunn":{"songs":["Brand New Man","Neon Moon"],"prices":{"Brand New Man":"E","Neon Moon":"C"},"icons":{"Brand New Man":"","Neon Moon":""}},"Charley Pride":{"songs":["Kiss An Angel Good Mornin","Is anybody Going to San Antone"],"prices":{"Kiss An Angel Good Mornin":"E","Is anybody Going to San Antone":"E"},"icons":{"Kiss An Angel Good Mornin":"","Is anybody Going to San Antone":""}},"Charlie Crockett":{"songs":["Just Like Honey","just a Clown"],"prices":{"Just Like Honey":"E","just a Clown":"E"},"icons":{"Just Like Honey":"","just a Clown":""}},"Chris Isaak":{"songs":["Wicked Game"],"prices":{"Wicked Game":"E"},"icons":{"Wicked Game":""}},"Conway Twitty":{"songs":["I Don't Know A Thing About Love","Tight Fitting Jeans"],"prices":{"I Don't Know A Thing About Love":"E","Tight Fitting Jeans":"E"},"icons":{"I Don't Know A Thing About Love":"","Tight Fitting Jeans":""}},"David Allan Coe":{"songs":["The Ride","Never Called Me By My Name"],"prices":{"The Ride":"E","Never Called Me By My Name":"C"},"icons":{"The Ride":"","Never Called Me By My Name":""}},"Dixie Chicks":{"songs":["Wide Open Spaces","You Were Mine"],"prices":{"Wide Open Spaces":"E","You Were Mine":"E"},"icons":{"Wide Open Spaces":"","You Were Mine":""}},"Dwight Yoakam":{"songs":["Honkey Tonk Man","Guitars Cadillac's"],"prices":{"Honkey Tonk Man":"E","Guitars Cadillac's":"C"},"icons":{"Honkey Tonk Man":"","Guitars Cadillac's":""}},"Elvis Presley":{"songs":["I Can't Help Falling In Love with You","That's Alright Mama"],"prices":{"I Can't Help Falling In Love with You":"C","That's Alright Mama":"E"},"icons":{"I Can't Help Falling In Love with You":"","That's Alright Mama":""}},"Garth Brooks":{"songs":["Thunder Rolls","The Dance","Low Places"],"prices":{"Thunder Rolls":"E","The Dance":"E","Low Places":"C"},"icons":{"Thunder Rolls":"","The Dance":"","Low Places":""}},"George Jones":{"songs":["The Good Times Ain't Over","Who's Gonna Fill Those Shoes"],"prices":{"The Good Times Ain't Over":"E","Who's Gonna Fill Those Shoes":"C"},"icons":{"The Good Times Ain't Over":"","Who's Gonna Fill Those Shoes":""}},"George Strait":{"songs":["Marina Del Rey","All My Ex's Live In Texas","Amarillo By Morning","The Chair","Unwound","Nobody In His Right Mind"],"prices":{"Marina Del Rey":"E","All My Ex's Live In Texas":"C","Amarillo By Morning":"E","The Chair":"E","Unwound":"E","Nobody In His Right Mind":"E"},"icons":{"Marina Del Rey":"","All My Ex's Live In Texas":"","Amarillo By Morning":"","The Chair":"","Unwound":"","Nobody In His Right Mind":""}},"Green Day":{"songs":["Good Riddance"],"prices":{"Good Riddance":"E"},"icons":{"Good Riddance":""}},"Hank Williams Jr.":{"songs":["Family Tradition","Dinosaur","Whiskey Bent","Women I Never Had"],"prices":{"Family Tradition":"E","Dinosaur":"C","Whiskey Bent":"E","Women I Never Had":"E"},"icons":{"Family Tradition":"","Dinosaur":"","Whiskey Bent":"","Women I Never Had":""}},"Hank Williams Sr.":{"songs":["Jambalaya","Buckets Got A Hole In It","Your Cheatin Heart"],"prices":{"Jambalaya":"E","Buckets Got A Hole In It":"E","Your Cheatin Heart":"E"},"icons":{"Jambalaya":"","Buckets Got A Hole In It":"","Your Cheatin Heart":""}},"Hogleg Band":{"songs":["How It Feels To Be Cowboy","Road To Texas","My Dog Still Loves Me","1 of Us Is Wrong"],"prices":{"How It Feels To Be Cowboy":"C","Road To Texas":"D","My Dog Still Loves Me":"D","1 of Us Is Wrong":"D"},"icons":{"How It Feels To Be Cowboy":"","Road To Texas":"","My Dog Still Loves Me":"","1 of Us Is Wrong":""}},"James Taylor":{"songs":["Sweet Baby James"],"prices":{"Sweet Baby James":"E"},"icons":{"Sweet Baby James":""}},"Jamey Johnson":{"songs":["In Color"],"prices":{"In Color":"C"},"icons":{"In Color":""}},"Jimi Hendrix":{"songs":["Wind Cries Mary","Red House","Little Wing"],"prices":{"Wind Cries Mary":"E","Red House":"C","Little Wing":"E"},"icons":{"Wind Cries Mary":"","Red House":"","Little Wing":""}},"Jimmy Buffett":{"songs":["Margaritaville"],"prices":{"Margaritaville":"E"},"icons":{"Margaritaville":""}},"John Anderson":{"songs":["Black Sheep","Chuck Of Coal"],"prices":{"Black Sheep":"E","Chuck Of Coal":"E"},"icons":{"Black Sheep":"","Chuck Of Coal":""}},"John Denver":{"songs":["Country Roads"],"prices":{"Country Roads":"E"},"icons":{"Country Roads":""}},"Johnny Cash":{"songs":["Ring Of Fire","Folsom Prison Blues","Hurt"],"prices":{"Ring Of Fire":"E","Folsom Prison Blues":"E","Hurt":"C"},"icons":{"Ring Of Fire":"","Folsom Prison Blues":"","Hurt":""}},"Kenny Rogers":{"songs":["Lady","Islands in the Stream (duet)"],"prices":{"Lady":"C","Islands in the Stream (duet)":"C"},"icons":{"Lady":"","Islands in the Stream (duet)":""}},"Keith Whitley":{"songs":["Honkey Tonk Heart","No Stranger To The Rain","Don't Close Your Eyes","I Wonder Do You Think Of Me"],"prices":{"Honkey Tonk Heart":"E","No Stranger To The Rain":"E","Don't Close Your Eyes":"E","I Wonder Do You Think Of Me":"C"},"icons":{"Honkey Tonk Heart":"","No Stranger To The Rain":"","Don't Close Your Eyes":"","I Wonder Do You Think Of Me":""}},"Lance":{"songs":["Custom Happy Birthday Tribute Song"],"prices":{"Custom Happy Birthday Tribute Song":"B"},"icons":{"Custom Happy Birthday Tribute Song":""}},"Lance Woolie":{"songs":["Too Drunk","Worst Enemy","Uber","How It Feels To Be a Cowboy","Road To Texas","Crazy Arms","Back Home","TRUST","One of Us is Wrong","Little Wing"],"prices":{"Too Drunk":"E","Worst Enemy":"C","Uber":"E","How It Feels To Be a Cowboy":"C","Road To Texas":"E","Crazy Arms":"E","Back Home":"E","TRUST":"E","One of Us is Wrong":"E","Little Wing":"E"},"icons":{"Too Drunk":"","Worst Enemy":"","Uber":"","How It Feels To Be a Cowboy":"","Road To Texas":"","Crazy Arms":"","Back Home":"","TRUST":"","One of Us is Wrong":"","Little Wing":""}},"Lee Greenwood":{"songs":["God Bless The USA"],"prices":{"God Bless The USA":"A"},"icons":{"God Bless The USA":""}},"Little Feat":{"songs":["Willin"],"prices":{"Willin":"E"},"icons":{"Willin":""}},"Lynn Anderson":{"songs":["Rose Garden"],"prices":{"Rose Garden":"C"},"icons":{"Rose Garden":""}},"Lynyrd Skynyrd":{"songs":["Simple Man","Free Bird","Sweet Home Alabama"],"prices":{"Simple Man":"E","Free Bird":"A","Sweet Home Alabama":"E"},"icons":{"Simple Man":"","Free Bird":"","Sweet Home Alabama":""}},"Merle Haggard":{"songs":["That's The Way Love Goes","Big City","Working Man Blues","I Just Stay Here and Drink"],"prices":{"That's The Way Love Goes":"E","Big City":"E","Working Man Blues":"C","I Just Stay Here and Drink":"E"},"icons":{"That's The Way Love Goes":"","Big City":"","Working Man Blues":"","I Just Stay Here and Drink":""}},"Michael Jackson":{"songs":["I Want You Back"],"prices":{"I Want You Back":"E"},"icons":{"I Want You Back":""}},"Midland":{"songs":["Drinking Problem"],"prices":{"Drinking Problem":"E"},"icons":{"Drinking Problem":""}},"Nirvana":{"songs":["Man Who Sold The World","All Apologies"],"prices":{"Man Who Sold The World":"E","All Apologies":"E"},"icons":{"Man Who Sold The World":"","All Apologies":""}},"Parker McCollum":{"songs":["Pretty Heart"],"prices":{"Pretty Heart":"E"},"icons":{"Pretty Heart":""}},"Post Malone":{"songs":["Circles"],"prices":{"Circles":"E"},"icons":{"Circles":""}},"Ray Wylie Hubbard":{"songs":["Snake Farm","Red Neck Mother"],"prices":{"Snake Farm":"E","Red Neck Mother":"B"},"icons":{"Snake Farm":"","Red Neck Mother":""}},"REM":{"songs":["Losing My Religion"],"prices":{"Losing My Religion":"E"},"icons":{"Losing My Religion":""}},"Randy Travis":{"songs":["Forever & Ever Amen","Digging Up Bones","I Told You So"],"prices":{"Forever & Ever Amen":"E","Digging Up Bones":"C","I Told You So":"E"},"icons":{"Forever & Ever Amen":"","Digging Up Bones":"","I Told You So":""}},"Rodney Carrington":{"songs":["Dear Penis"],"prices":{"Dear Penis":"B"},"icons":{"Dear Penis":""}},"Ricky Skaggs":{"songs":["Heartbroke","Country Boy","Highway 40 Blues"],"prices":{"Heartbroke":"E","Country Boy":"E","Highway 40 Blues":"C"},"icons":{"Heartbroke":"","Country Boy":"","Highway 40 Blues":""}},"Rolling Stones":{"songs":["Wild Horses","Angel"],"prices":{"Wild Horses":"E","Angel":"E"},"icons":{"Wild Horses":"","Angel":""}},"Ronnie Milsap":{"songs":["Stranger In My House","Smokey Mountain Rain","The Freeze"],"prices":{"Stranger In My House":"E","Smokey Mountain Rain":"E","The Freeze":"C"},"icons":{"Stranger In My House":"","Smokey Mountain Rain":"","The Freeze":""}},"Stevie Wonder":{"songs":["I Just Called To Say I Love You","Superstition"],"prices":{"I Just Called To Say I Love You":"E","Superstition":"E"},"icons":{"I Just Called To Say I Love You":"","Superstition":""}},"Tex Hooper":{"songs":["Man Hole Inspector","Texas On A Saturday Night","Empty Bed"],"prices":{"Man Hole Inspector":"B","Texas On A Saturday Night":"B","Empty Bed":"B"},"icons":{"Man Hole Inspector":"","Texas On A Saturday Night":"","Empty Bed":""}},"The Civil Wars":{"songs":["20 Years","Dance Me To The End Of Love"],"prices":{"20 Years":"E","Dance Me To The End Of Love":"E"},"icons":{"20 Years":"","Dance Me To The End Of Love":""}},"The Eagles":{"songs":["Tequila Sunrise","Witchy Woman","Hotel California"],"prices":{"Tequila Sunrise":"E","Witchy Woman":"E","Hotel California":"C"},"icons":{"Tequila Sunrise":"","Witchy Woman":"","Hotel California":""}},"The Highwaymen":{"songs":["Highwayman"],"prices":{"Highwayman":"C"},"icons":{"Highwayman":""}},"Tom Petty":{"songs":["Won't Back Down","You Got Lucky"],"prices":{"Won't Back Down":"E","You Got Lucky":"E"},"icons":{"Won't Back Down":"","You Got Lucky":""}},"Tracy Lawrence":{"songs":["Time Marches On","Sticks And Stones"],"prices":{"Time Marches On":"E","Sticks And Stones":"E"},"icons":{"Time Marches On":"","Sticks And Stones":""}},"Travis Tritt":{"songs":["Help Me Hold On"],"prices":{"Help Me Hold On":"E"},"icons":{"Help Me Hold On":""}},"Van Morrison":{"songs":["Moondance"],"prices":{"Moondance":"C"},"icons":{"Moondance":""}},"Vince Gill":{"songs":["Tryin To Get Over You"],"prices":{"Tryin To Get Over You":"E"},"icons":{"Tryin To Get Over You":""}},"Waylon Jennings":{"songs":["Mamas Don't Let Your Babies","Luckenbach Texas"],"prices":{"Mamas Don't Let Your Babies":"C","Luckenbach Texas":"E"},"icons":{"Mamas Don't Let Your Babies":"","Luckenbach Texas":""}},"Wheeler Walker Jr.":{"songs":["Fuck You Bitch","Drop Em Out"],"prices":{"Fuck You Bitch":"B","Drop Em Out":"B"},"icons":{"Fuck You Bitch":"","Drop Em Out":""}},"Willie Nelson":{"songs":["Blue Eyes Crying","On The Road Again","City OF New Orleans"],"prices":{"Blue Eyes Crying":"E","On The Road Again":"E","City OF New Orleans":"C"},"icons":{"Blue Eyes Crying":"","On The Road Again":"","City OF New Orleans":""}},"Zach Top":{"songs":["Bad Luck","I Never Lie","Dirt To Gold","When You See Me","South of Sanity"],"prices":{"Bad Luck":"E","I Never Lie":"C","Dirt To Gold":"E","When You See Me":"E","South of Sanity":"E"},"icons":{"Bad Luck":"","I Never Lie":"","Dirt To Gold":"","When You See Me":"","South of Sanity":""}}};

    // Price map (hidden)
    const prices = {'A':50, 'B':25, 'C':15, 'D':10, 'E':5};

    // Cart (localStorage)
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let baseTotal = 0;
    let roundedTotal = 0;
    let clearIntervalId = null;

    // Title case function
    function toTitleCase(str) {
        return str.replace(/\w\S*/g, function(txt) {
            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
        });
    }

    // Show temporary notification
    function showNotification(message) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.classList.add('show');
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // Disable cart additions
    function disableAdditions() {
        document.body.classList.add('disabled-overlay');
        // Disable all add buttons
        const addButtons = document.querySelectorAll('button[onclick*="add"], details li');
        addButtons.forEach(btn => btn.disabled = true);
    }

    // Enable cart additions
    function enableAdditions() {
        document.body.classList.remove('disabled-overlay');
        const addButtons = document.querySelectorAll('button[onclick*="add"], details li');
        addButtons.forEach(btn => btn.disabled = false);
    }

    // Build artist accordion (alpha sorted)
    function buildArtists() {
        const sortedArtists = Object.keys(songsData).sort();
        let html = '';
        let navHtml = '<div id="alpha-nav"><div style="text-align: center; margin: 20px 0; font-size: 18px;">';
        for (let i = 65; i <= 90; i++) {
            const letter = String.fromCharCode(i);
            navHtml += `<a href="#letter-${letter}" style="color: #FFD700; text-decoration: none; margin: 0 1px; padding: 4px 6px; border-radius: 50%; background: rgba(0, 116, 217, 0.2); transition: all 0.3s ease; font-weight: bold; font-size: 14px;">${letter}</a>`;
        }
        navHtml += '</div></div>';

        html += navHtml;

        let prevLetter = '';
        sortedArtists.forEach(artist => {
            const firstLetter = artist.charAt(0).toUpperCase();
            if (firstLetter !== prevLetter) {
                html += `<a id="letter-${firstLetter}"></a>`;
                prevLetter = firstLetter;
            }
            html += `<details><summary>${artist}</summary><ul>`;
            songsData[artist].songs.forEach(song => {
                const escapedArtist = artist.replace(/'/g, "\\'");
                const escapedSong = song.replace(/'/g, "\\'");
                const tier = songsData[artist].prices[song];
                const price = prices[tier];
                const icon = songsData[artist].icons[song] || '';
                const displaySong = toTitleCase(song);
                let songColor = '#E0E0E0';
                if (tier === 'A') {
                    songColor = '#DAA520'; // off-bright gold
                } else if (tier === 'B') {
                    songColor = '#FF00FF'; // off-bright magenta
                } else if (tier === 'D') {
                    songColor = '#40E0D0'; // off-bright cyan
                } else if (tier === 'C') {
                    songColor = '#FF8C00'; // off-bright orange
                }
                html += `<li onclick="addSong('${escapedArtist}', '${escapedSong}')"><span style="color: ${songColor};">${displaySong}</span> (<span style="color: #32CD32">$${price}</span>) <span class="song-icon">${icon}</span></li>`;
            });
            html += '</ul></details>';
        });
        document.getElementById('artists-section').innerHTML = html;
        console.log('Artists built:', sortedArtists.length); // Debug log
    }

    // Remove item from cart
    function removeItem(index) {
        cart.splice(index, 1);
        updateCart();
    }

    // Toggle roundup
    function toggleRoundup() {
        updateCart();
    }

    // Update cart display
    function updateCart() {
        localStorage.setItem('cart', JSON.stringify(cart));
        document.getElementById('cart-count').textContent = cart.length;
        let itemsHtml = '';
        baseTotal = 0;
        cart.forEach((item, index) => {
            let price = item.amount || prices[item.tier] || 0;
            baseTotal += price;
            let display = item.type === 'tip' ? `Tip: $${price}` : `${item.artist ? item.artist + ' - ' : ''}${item.song}`;
            itemsHtml += `<li>${display} ($${price}) <span class="remove-btn" onclick="removeItem(${index})">×</span></li>`;
        });
        document.getElementById('cart-items').innerHTML = itemsHtml;
        roundedTotal = Math.ceil(baseTotal / 10) * 10;
        const roundupChecked = document.getElementById('roundup').checked;
        document.getElementById('total').textContent = (roundupChecked ? roundedTotal : baseTotal).toFixed(2);

        // Show/hide PayPal container based on baseTotal
        const paypalContainer = document.getElementById('paypal-button-container');
        if (baseTotal > 0) {
            paypalContainer.style.display = 'block';
        } else {
            paypalContainer.style.display = 'none';
        }
    }

    // Render PayPal buttons (once on load)
    function renderPayPal() {
        const container = document.getElementById('paypal-button-container');
        container.innerHTML = ''; // Clear any existing content

        paypal.Buttons({
            createOrder: (data, actions) => {
                const roundupChecked = document.getElementById('roundup').checked;
                const total = roundupChecked ? roundedTotal : baseTotal;
                if (total <= 0) {
                    throw new Error('Cart is empty. Add items to proceed with payment.');
                }
                return actions.order.create({
                    purchase_units: [{ amount: { value: total.toFixed(2) } }]
                });
            },
            onApprove: async (data, actions) => {
                const form = document.getElementById('checkout-form');
                const fanName = form.querySelector('input[name="Fan Name"]').value;
                const message = form.querySelector('textarea[name="message"]').value || '';
                const roundupChecked = document.getElementById('roundup').checked;
                const total = roundupChecked ? roundedTotal : baseTotal;

                try {
                    console.log('onApprove data:', data);
                    const details = await actions.order.capture();
                    console.log('Capture details:', details);
                    // Immediate clear and show thank you
                    showThankyou(fanName, message, total);
                    // Fire log in background
                    logToFirebase(fanName, message, total).catch(console.error);
                } catch (err) {
                    console.error('Full capture error:', err);
                    alert(`Payment failed: ${err.message || 'Capture error'} - try again or contact support`);
                }
            },
            onError: (err) => {
                console.error('PayPal error:', err);
                showNotification('Payment error. Please try again.');
            }
        }).render('#paypal-button-container');
    }

    // Add song
    function addSong(artist, song) {
        const tier = songsData[artist].prices[song];
        cart.push({artist, song, tier});
        updateCart();
        showNotification('Song added to cart! Check out now, or request multiple songs.');
        showCart();
    }

    // Add tip
    function addTip(amount) {
        cart.push({type: 'tip', amount});
        updateCart();
        showNotification('THANK YOU, tip added to cart');
        showCart();
    }

    // Free suggestion
    function freeSuggestion() {
        showCart();
        setTimeout(() => {
            document.querySelector('textarea[name="message"]').scrollIntoView({behavior: 'smooth'});
            document.querySelector('textarea[name="message"]').focus();
        }, 500);
    }

    // Add custom tip
    function addCustomTip() {
        const amt = parseFloat(document.getElementById('custom-tip').value) || 0;
        cart.push({type: 'tip', amount: amt});
        document.getElementById('custom-tip').value = '';
        updateCart();
        showNotification('THANK YOU, tip added to cart');
        showCart();
    }

    // Add custom song
    function addCustomSong() {
        const song = document.getElementById('custom-song').value.trim();
        if (song) {
            cart.push({song, amount: 20, custom: true});
            document.getElementById('custom-song').value = '';
            updateCart();
            showNotification(`${song} ($20) added to cue!`);
            showCart();
        } else {
            showNotification('Enter a song name!');
        }
    }

    // Show cart
    function showCart() {
        document.getElementById('cart-section').style.display = 'block';
        document.getElementById('cart-section').scrollIntoView({behavior: 'smooth'});
    }

    // Show thanks with random message and reinforcement
    function showThankyou(fanName = '', message = '', total = 0) {
        // Immediate clear
        cart = [];
        localStorage.removeItem('cart');
        updateCart();

        // Set freshlyPaid flag (15 min expiry)
        localStorage.setItem('freshlyPaid', Date.now().toString());

        // Disable additions
        disableAdditions();

        // Show thank you
        document.getElementById('cart-section').style.display = 'none';
        const thankyouDiv = document.getElementById('thankyou');
        thankyouDiv.style.display = 'block';
        thankyouDiv.scrollIntoView({behavior: 'smooth'});

        // Random message (for paid; free uses default)
        if (total > 0) {
            const randomMsg = thankYouMessages[Math.floor(Math.random() * thankYouMessages.length)];
            document.getElementById('thankyou-message').textContent = randomMsg;
        }

        // Reinforcement interval: Check/clear every second for 10 seconds
        let checkCount = 0;
        const maxChecks = 10; // 10 seconds
        clearIntervalId = setInterval(() => {
            // Force clear if any cart remnants
            if (localStorage.getItem('cart')) {
                localStorage.removeItem('cart');
                cart = [];
                updateCart();
            }
            checkCount++;
            if (checkCount >= maxChecks) {
                clearInterval(clearIntervalId);
                // Re-enable after timeout
                enableAdditions();
                // Optional auto-reload after linger
                setTimeout(() => location.reload(), 2000);
            }
        }, 1000);
    }

    // Init Firebase after DOM
    function initFirebase() {
        if (firebaseConfig.apiKey) { // Only if config provided
            firebase.initializeApp(firebaseConfig);
            window.db = firebase.firestore();
        } else {
            console.warn('Firebase config missing - logging will fail');
        }
    }

    // Log to Firebase on successful checkout (now handles missing doc)
    async function logToFirebase(fanName, message, paidTotal) {
        if (!window.db) {
            console.warn('Firebase not initialized - skipping log');
            return;
        }

        try {
            const timestamp = firebase.firestore.FieldValue.serverTimestamp();
            const analyticsDocRef = window.db.collection('analytics').doc('visitorsanalytics');
            const extra = paidTotal - baseTotal;

            // Log full order
            await window.db.collection('orders').add({
                fanName,
                message,
                baseTotal,
                paidTotal,
                extra,
                timestamp,
                items: cart.map(item => {
                    if (item.type === 'tip') {
                        return {type: 'tip', amount: item.amount};
                    } else if (item.custom) {
                        return {type: 'custom_song', song: item.song, price: item.amount};
                    } else {
                        return {type: 'song', artist: item.artist, song: item.song, price: prices[item.tier]};
                    }
                })
            });

            // Log individual items separately
            for (const item of cart) {
                if (item.type === 'tip') {
                    // Log tips separately
                    await window.db.collection('tips').add({
                        amount: item.amount,
                        fanName,
                        timestamp
                    });
                    continue;
                }
                let data;
                if (item.custom) {
                    data = {
                        song: item.song,
                        price: item.amount,
                        fanName,
                        message,
                        paidTotal,
                        timestamp
                    };
                    await window.db.collection('custom_requests').add(data);
                } else {
                    data = {
                        artist: item.artist,
                        song: item.song,
                        price: prices[item.tier],
                        fanName,
                        message,
                        paidTotal,
                        timestamp
                    };
                    await window.db.collection('song_requests').add(data);
                }
            }

            // Analytics for confirmed sales - use set with merge to create doc if missing
            const songsCount = cart.filter(item => item.type !== 'tip').length;
            const explicitTipsSum = cart.filter(item => item.type === 'tip').reduce((sum, item) => sum + (item.amount || 0), 0);
            const tipsForAnalytics = explicitTipsSum + extra;

            await analyticsDocRef.set({
                songs_sold: firebase.firestore.FieldValue.increment(songsCount),
                tips_total: firebase.firestore.FieldValue.increment(tipsForAnalytics)
            }, { merge: true });

            console.log('Firebase log success!'); // Debug win
        } catch (firebaseErr) {
            console.error('Firebase log failed (non-blocking):', firebaseErr); // Swallow without alert
            // Optional: Add to a fallback log, e.g., localStorage or email yourself
        }
    }

    // Checkout
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('checkout-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const roundupChecked = document.getElementById('roundup').checked;
            const total = roundupChecked ? roundedTotal : baseTotal;

            if (total > 0) {
                showNotification('Please use the PayPal button to complete your purchase.');
                return;
            }

            // Free suggestion flow
            const formData = new FormData(e.target);
            const fanName = formData.get('Fan Name');
            const message = formData.get('message') || '';

            if (window.db) {
                const timestamp = firebase.firestore.FieldValue.serverTimestamp();
                window.db.collection('suggestions').add({
                    fanName,
                    message,
                    timestamp
                }).catch(console.warn); // Non-blocking
            }
            // For free, shorter reinforcement (3s)
            showThankyou(fanName, message, 0);
            // Adjust interval for free: maxChecks = 3
            const originalMax = 10;
            // Note: For free, we can override or just let it run short
        });

        buildArtists();
        initFirebase();
        // Check for freshlyPaid flag on load
        const freshlyPaid = localStorage.getItem('freshlyPaid');
        if (freshlyPaid) {
            const now = Date.now();
            const flagAge = now - parseInt(freshlyPaid);
            if (flagAge < 15 * 60 * 1000) { // 15 min
                cart = [];
                localStorage.removeItem('cart');
                showNotification('Payment complete—queue reset!');
            }
            localStorage.removeItem('freshlyPaid'); // Clean up
        }
        // Log visitor (use set with merge to create doc if missing)
        if (window.db) {
            const analyticsDocRef = window.db.collection('analytics').doc('visitorsanalytics');
            analyticsDocRef.set({
                visitors: firebase.firestore.FieldValue.increment(1)
            }, { merge: true }).catch(console.warn); // Non-blocking
        }
        updateCart();
        // Render PayPal buttons once after initial setup
        if (typeof paypal !== 'undefined') {
            renderPayPal();
        }
    });
</script></body>
</html>
